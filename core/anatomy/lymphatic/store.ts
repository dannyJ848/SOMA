/**
 * Lymphatic & Immune System Data Store
 *
 * Lymphatic organs, vessels, immune cells, and responses.
 */

import type {
  LymphaticStructure,
  LymphNodeRegion,
  ImmuneCell,
  Cytokine,
  ImmunoglobulinClass,
  ImmuneResponsePhase,
  LymphaticStatistics,
  LymphaticOrganType,
} from './types';

// ============================================================================
// LYMPHATIC STRUCTURES
// ============================================================================

const lymphaticStructures: Map<string, LymphaticStructure> = new Map();

// --- Primary Lymphoid Organs ---
lymphaticStructures.set('bone-marrow', {
  id: 'bone-marrow',
  name: 'Bone Marrow',
  latinName: 'Medulla ossium',
  fmaId: 'FMA:9608',
  organType: 'primary',
  location: 'Medullary cavity of bones; red marrow in axial skeleton, proximal long bones',
  function: 'Hematopoiesis - production of all blood cells and B cell maturation',
  histology: 'Hematopoietic cells, adipocytes, stromal cells, sinusoidal capillaries',
  cellPopulations: ['Hematopoietic stem cells', 'Developing B cells', 'Myeloid progenitors', 'Erythroid progenitors', 'Megakaryocytes'],
  bloodSupply: ['Nutrient arteries of bones'],
  explanations: {
    level1: 'Bone marrow is the soft tissue inside your bones where blood cells are made.',
    level2: 'Red bone marrow produces all types of blood cells: red cells (carry oxygen), white cells (fight infection), and platelets (stop bleeding). As you age, some marrow becomes yellow (fatty).',
    level3: 'Bone marrow contains hematopoietic stem cells (HSCs) that give rise to all blood cell lineages. It\'s also a primary lymphoid organ where B cells mature. The microenvironment (niche) regulates HSC self-renewal and differentiation.',
    level4: 'HSCs reside in perivascular niches near sinusoids. Cytokines (SCF, IL-3, IL-7, TPO) regulate lineage commitment. B cell development proceeds through pro-B, pre-B, and immature B stages with V(D)J recombination. Negative selection removes self-reactive B cells.',
    level5: 'HSC maintenance requires niche signals: SCF/c-kit, CXCL12/CXCR4, Notch, Wnt. Commitment to myeloid vs lymphoid lineage involves master transcription factors: PU.1 (myeloid), GATA-1 (erythroid), PAX5 (B cells). B cell receptor diversity generated by RAG-mediated V(D)J recombination and TdT-mediated N-nucleotide addition. Allelic exclusion ensures one BCR specificity per cell.',
  },
  keyFacts: [
    'Primary site of hematopoiesis in adults',
    'Primary lymphoid organ for B cell maturation',
    'Red marrow: active hematopoiesis',
    'Yellow marrow: fatty, can revert to red if needed',
    'Produces ~500 billion cells daily',
  ],
  pathologies: [
    {
      name: 'Aplastic anemia',
      description: 'Bone marrow failure with pancytopenia',
      symptoms: ['Fatigue (anemia)', 'Infections (leukopenia)', 'Bleeding (thrombocytopenia)'],
      causes: ['Idiopathic', 'Drugs', 'Viral', 'Autoimmune'],
      labFindings: ['Pancytopenia', 'Hypocellular marrow'],
    },
    {
      name: 'Leukemia',
      description: 'Malignant proliferation of blood cell precursors',
      symptoms: ['Fatigue', 'Infections', 'Bleeding', 'Bone pain'],
      causes: ['Genetic mutations', 'Radiation', 'Chemicals'],
      labFindings: ['Abnormal WBC', 'Blasts in blood/marrow'],
    },
    {
      name: 'Multiple myeloma',
      description: 'Plasma cell malignancy in bone marrow',
      symptoms: ['Bone pain', 'Anemia', 'Renal failure', 'Infections'],
      causes: ['Plasma cell clone expansion'],
      labFindings: ['M-spike on SPEP', 'Bence Jones protein', 'Lytic bone lesions'],
    },
  ],
  relevantLabs: ['CBC with differential', 'Reticulocyte count', 'Bone marrow biopsy'],
  relevantImaging: ['MRI for marrow assessment', 'PET-CT for malignancy'],
});

lymphaticStructures.set('thymus', {
  id: 'thymus',
  name: 'Thymus',
  latinName: 'Thymus',
  fmaId: 'FMA:9607',
  organType: 'primary',
  location: 'Anterior mediastinum, posterior to sternum',
  function: 'T cell maturation and selection',
  dimensions: 'Largest in childhood (~30-40 g at puberty), involutes with age',
  histology: 'Cortex (immature thymocytes), Medulla (mature thymocytes, Hassall corpuscles), epithelial cells',
  cellPopulations: ['Thymocytes (developing T cells)', 'Thymic epithelial cells', 'Dendritic cells', 'Macrophages'],
  bloodSupply: ['Internal thoracic artery branches', 'Inferior thyroid artery branches'],
  explanations: {
    level1: 'The thymus is where special white blood cells called T cells learn to fight infections without attacking your own body.',
    level2: 'The thymus trains T cells. T cells that react to your own body are eliminated, and those that can fight infections are released. The thymus is largest in childhood and shrinks with age.',
    level3: 'T cell progenitors from bone marrow enter the thymus and undergo positive selection (MHC restriction) in the cortex and negative selection (self-tolerance) in the medulla. Only ~2% survive to become mature T cells.',
    level4: 'Positive selection in cortex: thymocytes must recognize self-MHC to survive. CD4+ selected on MHC class II; CD8+ on MHC class I. Negative selection in medulla: AIRE expression presents tissue-specific antigens; strongly self-reactive cells undergo apoptosis. Some become regulatory T cells.',
    level5: 'TCR gene rearrangement (V(D)J recombination) generates diversity. Notch signaling commits progenitors to T lineage. Positive selection requires TCR:MHC interaction of intermediate affinity (too weak = neglect death; too strong = negative selection). AIRE (autoimmune regulator) drives ectopic expression of peripheral tissue antigens in medullary thymic epithelial cells. AIRE mutations cause APECED (autoimmune polyendocrinopathy).',
  },
  keyFacts: [
    'Primary lymphoid organ for T cell maturation',
    'Largest at puberty, involutes (fatty replacement) with age',
    'Positive selection: cortex (MHC restriction)',
    'Negative selection: medulla (self-tolerance)',
    '~98% of thymocytes die during selection',
  ],
  pathologies: [
    {
      name: 'DiGeorge syndrome',
      description: 'Thymic aplasia/hypoplasia from 22q11 deletion',
      symptoms: ['Recurrent infections (T cell deficiency)', 'Cardiac defects', 'Hypocalcemia', 'Facial abnormalities'],
      causes: ['22q11.2 deletion'],
      labFindings: ['Low T cells', 'Low PTH', 'Hypocalcemia'],
    },
    {
      name: 'Thymoma',
      description: 'Tumor of thymic epithelial cells',
      symptoms: ['Often asymptomatic', 'Myasthenia gravis (30%)', 'Pure red cell aplasia', 'Hypogammaglobulinemia'],
      causes: ['Unknown'],
      relevantImaging: ['CT chest', 'PET-CT'],
    },
    {
      name: 'Myasthenia gravis',
      description: 'Autoimmune attack on ACh receptors, associated with thymus',
      symptoms: ['Fatigable weakness', 'Ptosis', 'Diplopia', 'Dysphagia'],
      causes: ['Anti-AChR antibodies', 'Thymic abnormality (hyperplasia or thymoma)'],
      labFindings: ['Anti-AChR antibodies', 'Anti-MuSK antibodies'],
    },
  ],
  relevantLabs: ['T cell count', 'T cell subsets (CD4/CD8)', 'Anti-AChR antibodies'],
  relevantImaging: ['CT chest', 'MRI mediastinum'],
  relatedStructures: ['heart', 'great-vessels', 'trachea'],
});

// --- Secondary Lymphoid Organs ---
lymphaticStructures.set('spleen', {
  id: 'spleen',
  name: 'Spleen',
  latinName: 'Lien/Splen',
  fmaId: 'FMA:7196',
  organType: 'secondary',
  location: 'Left upper quadrant, beneath left hemidiaphragm, posterior to stomach',
  function: 'Blood filtration, immune surveillance, RBC recycling, reservoir for platelets/monocytes',
  dimensions: '12 × 7 × 3 cm (~150 g), enlarges in disease',
  histology: 'White pulp (lymphoid, PALS + follicles), Red pulp (sinusoids, cords of Billroth), Marginal zone',
  cellPopulations: ['T cells (PALS)', 'B cells (follicles)', 'Macrophages (red pulp)', 'Dendritic cells'],
  bloodSupply: ['Splenic artery (from celiac trunk)'],
  drainage: ['Splenic vein → Portal vein'],
  explanations: {
    level1: 'The spleen filters your blood and helps fight infections.',
    level2: 'The spleen removes old or damaged red blood cells, stores platelets, and contains immune cells that fight blood-borne infections. It\'s protected by the rib cage.',
    level3: 'White pulp contains T cells (periarteriolar lymphoid sheaths) and B cells (follicles) for immune response. Red pulp filters blood, removing senescent RBCs and encapsulated bacteria. The marginal zone is a transition area important for rapid response.',
    level4: 'Blood enters via splenic artery → central artery in PALS (T cells) → marginal zone → red pulp sinusoids. Macrophages in red pulp cords phagocytose opsonized cells and pathogens. The spleen is critical for clearance of encapsulated bacteria (pneumococcus, H. flu, meningococcus).',
    level5: 'Splenic architecture optimizes antigen sampling: PALS T cells interact with dendritic cells; B cells in follicles can form germinal centers for affinity maturation. Marginal zone B cells respond rapidly to blood-borne polysaccharide antigens. Asplenia increases susceptibility to encapsulated bacteria (require vaccination). IgM memory B cells lost after splenectomy. Splenic sequestration in sickle cell disease leads to functional asplenia.',
  },
  keyFacts: [
    '1-3-5-7-9-11 rule: 1×3×5 inches, 7 oz, lies btw ribs 9-11',
    'White pulp: lymphoid (T cells around arteries, B cells in follicles)',
    'Red pulp: RBC filtration, macrophages',
    'Filters encapsulated bacteria - asplenia increases infection risk',
    'Stores ~30% of platelets',
  ],
  pathologies: [
    {
      name: 'Splenomegaly',
      description: 'Enlarged spleen',
      symptoms: ['Left upper quadrant fullness', 'Early satiety', 'Cytopenias (hypersplenism)'],
      causes: ['Portal hypertension', 'Infections (mono)', 'Hematologic malignancy', 'Hemolytic anemias'],
      relevantImaging: ['Ultrasound', 'CT abdomen'],
    },
    {
      name: 'Splenic rupture',
      description: 'Traumatic or spontaneous rupture',
      symptoms: ['LUQ pain', 'Referred left shoulder pain (Kehr sign)', 'Hypotension'],
      causes: ['Trauma', 'Infectious mononucleosis', 'Splenomegaly'],
      relevantImaging: ['CT with contrast (emergent)'],
    },
    {
      name: 'Functional asplenia',
      description: 'Loss of splenic function without surgical removal',
      symptoms: ['Increased infection risk'],
      causes: ['Sickle cell disease (autosplenectomy)', 'Splenic infarcts'],
      labFindings: ['Howell-Jolly bodies on smear'],
    },
  ],
  relevantLabs: ['CBC', 'Peripheral smear (Howell-Jolly bodies if asplenic)', 'LDH', 'Haptoglobin'],
  relevantImaging: ['Ultrasound', 'CT abdomen'],
  relatedStructures: ['stomach', 'left-kidney', 'diaphragm', 'splenic-flexure'],
});

lymphaticStructures.set('lymph-node', {
  id: 'lymph-node',
  name: 'Lymph Node',
  latinName: 'Nodus lymphoideus',
  fmaId: 'FMA:5034',
  organType: 'secondary',
  location: 'Throughout body along lymphatic vessels',
  function: 'Filter lymph, initiate adaptive immune responses',
  dimensions: '1-25 mm (normal)',
  histology: 'Cortex (follicles - B cells), Paracortex (T cells), Medulla (plasma cells, macrophages)',
  cellPopulations: ['B cells (follicles)', 'T cells (paracortex)', 'Dendritic cells', 'Macrophages', 'Plasma cells'],
  drainage: ['Afferent lymphatics (multiple)', 'Efferent lymphatics (one, at hilum)'],
  explanations: {
    level1: 'Lymph nodes are small bean-shaped filters found throughout your body that trap germs and help fight infections.',
    level2: 'Lymph nodes filter the lymph fluid and contain immune cells. When you have an infection, lymph nodes may swell as immune cells multiply to fight the infection.',
    level3: 'Lymph nodes have organized zones: B cells in cortical follicles (form germinal centers during immune response), T cells in paracortex (interact with dendritic cells), medulla with plasma cells and macrophages. Afferent lymphatics bring lymph in; one efferent leaves at hilum.',
    level4: 'Antigens enter via afferent lymphatics or high endothelial venules (HEVs). Dendritic cells present antigen to T cells in paracortex. Activated T cells provide help to B cells at follicle border. B cells form germinal centers for affinity maturation and isotype switching.',
    level5: 'Lymph node architecture optimized for antigen encounter: fibroblastic reticular cells create conduit system for small antigens to reach follicular dendritic cells. HEVs express CCL21 and adhesins for lymphocyte entry. Chemokines (CXCL13, CCL19, CCL21) organize lymphocyte zones. Germinal center dark zone = centroblasts (proliferation, somatic hypermutation); light zone = centrocytes (selection on FDCs). Plasma cells migrate to medulla or bone marrow.',
  },
  keyFacts: [
    '~600 lymph nodes in the body',
    'Cortex: B cells, follicles (germinal centers during response)',
    'Paracortex: T cells, HEVs',
    'Medulla: plasma cells, macrophages',
    '>1 cm or hard, fixed, matted is concerning',
  ],
  pathologies: [
    {
      name: 'Lymphadenopathy',
      description: 'Enlarged lymph nodes',
      symptoms: ['Palpable node(s)', 'May be tender if reactive'],
      causes: ['Infection (reactive)', 'Malignancy (lymphoma, metastatic)', 'Autoimmune', 'Granulomatous disease'],
      relevantImaging: ['Ultrasound', 'CT', 'PET-CT'],
    },
    {
      name: 'Hodgkin lymphoma',
      description: 'Lymphoma with Reed-Sternberg cells',
      symptoms: ['Painless lymphadenopathy', 'B symptoms (fever, weight loss, night sweats)'],
      causes: ['EBV associated in some cases'],
      labFindings: ['Reed-Sternberg cells on biopsy'],
    },
    {
      name: 'Non-Hodgkin lymphoma',
      description: 'Heterogeneous group of lymphoid malignancies',
      symptoms: ['Lymphadenopathy', 'Extranodal involvement common', 'B symptoms'],
      causes: ['Various; some associated with infections (EBV, H. pylori)'],
    },
  ],
  relevantLabs: ['CBC', 'LDH', 'Lymph node biopsy'],
  relevantImaging: ['Ultrasound', 'CT', 'PET-CT'],
});

lymphaticStructures.set('tonsils', {
  id: 'tonsils',
  name: 'Tonsils (Waldeyer Ring)',
  latinName: 'Tonsillae',
  fmaId: 'FMA:54969',
  organType: 'secondary',
  location: 'Pharynx: palatine (lateral), pharyngeal/adenoid (roof), lingual (base of tongue), tubal (near auditory tube)',
  function: 'First line of defense against inhaled/ingested pathogens, antigen sampling',
  histology: 'Lymphoid follicles with germinal centers, covered by epithelium with crypts',
  cellPopulations: ['B cells (follicles)', 'T cells', 'M cells (sample antigens)', 'Macrophages'],
  bloodSupply: ['Tonsillar artery (facial a.), ascending palatine a., lingual a.'],
  drainage: ['Jugulodigastric lymph nodes'],
  explanations: {
    level1: 'Tonsils are lumps of immune tissue in your throat that help catch germs you breathe or swallow.',
    level2: 'The tonsils (palatine, adenoid, lingual, tubal) form a ring around the throat called Waldeyer\'s ring. They sample incoming pathogens and initiate immune responses.',
    level3: 'Tonsils contain B cell follicles beneath specialized epithelium with crypts that trap antigens. M cells sample particulate antigens. Germinal centers form during immune responses.',
    level4: 'Tonsillar crypts increase surface area for antigen encounter. Intraepithelial lymphocytes and M cells deliver antigens to underlying lymphoid tissue. Important site for IgA production protecting mucosal surfaces.',
    level5: 'Waldeyer ring is a major component of mucosa-associated lymphoid tissue (MALT). Specialized follicular dendritic cells present antigens for B cell selection. IgA class switching occurs with T cell help and TGF-β signaling. Chronic tonsillitis may reflect inadequate clearance or persistent antigenic stimulation.',
  },
  keyFacts: [
    'Waldeyer ring: palatine + pharyngeal (adenoid) + lingual + tubal tonsils',
    'No afferent lymphatics - antigens enter through epithelium',
    'Crypts increase surface area for antigen sampling',
    'Jugulodigastric node (tonsillar node) drains palatine tonsil',
    'Adenoid hypertrophy can obstruct nasopharynx in children',
  ],
  pathologies: [
    {
      name: 'Tonsillitis',
      description: 'Inflammation of palatine tonsils',
      symptoms: ['Sore throat', 'Dysphagia', 'Fever', 'Cervical lymphadenopathy'],
      causes: ['Viral (most common)', 'Group A Streptococcus', 'EBV (mononucleosis)'],
    },
    {
      name: 'Peritonsillar abscess (Quinsy)',
      description: 'Abscess between tonsil and pharyngeal muscle',
      symptoms: ['Severe sore throat', 'Trismus', '"Hot potato" voice', 'Uvular deviation'],
      causes: ['Complication of tonsillitis'],
      relevantImaging: ['CT neck with contrast'],
    },
    {
      name: 'Adenoid hypertrophy',
      description: 'Enlarged pharyngeal tonsil',
      symptoms: ['Nasal obstruction', 'Mouth breathing', 'Snoring', 'Recurrent otitis media'],
      causes: ['Repeated infections', 'Normal childhood enlargement'],
    },
  ],
  relatedStructures: ['pharynx', 'soft-palate', 'tongue'],
});

// ============================================================================
// LYMPH NODE REGIONS
// ============================================================================

export const LYMPH_NODE_REGIONS: LymphNodeRegion[] = [
  {
    id: 'cervical',
    name: 'Cervical Lymph Nodes',
    location: 'Along internal jugular vein and accessory nerve',
    drainsFrom: ['Head', 'Neck', 'Thyroid', 'Oral cavity'],
    drainsTo: 'Thoracic duct (left) or Right lymphatic duct',
    clinicalSignificance: 'Head and neck cancers, lymphoma, infections',
    palpable: true,
  },
  {
    id: 'supraclavicular',
    name: 'Supraclavicular Lymph Nodes',
    location: 'Above clavicle in supraclavicular fossa',
    drainsFrom: ['Thorax', 'Abdomen', 'Pelvis (via thoracic duct)'],
    drainsTo: 'Venous system at jugulo-subclavian junction',
    clinicalSignificance: 'Virchow node (left): GI malignancy; right: lung/esophageal cancer',
    palpable: true,
  },
  {
    id: 'axillary',
    name: 'Axillary Lymph Nodes',
    location: 'Axilla (5 groups: lateral, central, posterior, anterior, apical)',
    drainsFrom: ['Upper limb', 'Breast', 'Chest wall'],
    drainsTo: 'Subclavian trunk',
    clinicalSignificance: 'Breast cancer staging, melanoma, lymphoma',
    palpable: true,
  },
  {
    id: 'inguinal',
    name: 'Inguinal Lymph Nodes',
    location: 'Groin (superficial and deep)',
    drainsFrom: ['Lower limb', 'External genitalia', 'Perineum', 'Gluteal region', 'Lower abdominal wall'],
    drainsTo: 'External iliac nodes',
    clinicalSignificance: 'Genital cancers, melanoma of lower extremity, STIs',
    palpable: true,
  },
  {
    id: 'mediastinal',
    name: 'Mediastinal Lymph Nodes',
    location: 'Mediastinum (paratracheal, hilar, subcarinal)',
    drainsFrom: ['Lungs', 'Bronchi', 'Esophagus', 'Heart'],
    drainsTo: 'Bronchomediastinal trunks → thoracic duct',
    clinicalSignificance: 'Lung cancer staging, lymphoma, sarcoidosis',
    palpable: false,
  },
  {
    id: 'mesenteric',
    name: 'Mesenteric Lymph Nodes',
    location: 'Along mesenteric vessels in mesentery',
    drainsFrom: ['Small intestine', 'Large intestine'],
    drainsTo: 'Cisterna chyli → Thoracic duct',
    clinicalSignificance: 'GI malignancy, infections (TB, Whipple), lymphoma',
    palpable: false,
  },
  {
    id: 'pelvic',
    name: 'Pelvic Lymph Nodes',
    location: 'Along iliac vessels and obturator region',
    drainsFrom: ['Pelvic organs (bladder, prostate, uterus, cervix, rectum)'],
    drainsTo: 'Para-aortic nodes',
    clinicalSignificance: 'Gynecologic cancers, prostate cancer, rectal cancer',
    palpable: false,
  },
];

// ============================================================================
// IMMUNE CELLS
// ============================================================================

const immuneCells: Map<string, ImmuneCell> = new Map();

immuneCells.set('t-helper', {
  id: 't-helper',
  name: 'T Helper Cell (CD4+)',
  alternateNames: ['CD4+ T cell', 'Th cell'],
  type: 'lymphocyte',
  origin: 'Bone marrow',
  maturationSite: 'Thymus',
  lifespan: 'Weeks to months (memory cells: years)',
  surfaceMarkers: ['CD3', 'CD4', 'TCR'],
  functions: [
    'Coordinate immune response',
    'Help B cells produce antibodies',
    'Activate macrophages',
    'Secrete cytokines',
  ],
  cytokinesProduced: ['IL-2', 'IL-4', 'IL-5', 'IL-17', 'IFN-γ'],
  explanations: {
    level1: 'T helper cells are like generals that tell other immune cells what to do.',
    level2: 'T helper cells (CD4+) recognize antigens presented on MHC class II and coordinate the immune response by secreting cytokines that activate other cells.',
    level3: 'CD4+ T cells differentiate into subsets: Th1 (cell-mediated immunity, IFN-γ), Th2 (antibody response, IL-4/5/13), Th17 (mucosal immunity, IL-17), Treg (suppress responses). Subset determined by cytokine environment during activation.',
    level4: 'TCR recognizes peptide-MHC II complexes. Co-stimulation (CD28-B7) required for full activation. Cytokine milieu determines differentiation: IL-12 → Th1; IL-4 → Th2; TGF-β + IL-6 → Th17; TGF-β alone → iTreg. Master transcription factors: T-bet (Th1), GATA3 (Th2), RORγt (Th17), Foxp3 (Treg).',
    level5: 'Th1 cells activate macrophages via IFN-γ (enhanced killing) and help cytotoxic T cells. Th2 cells help B cells with IgE class switching (IL-4) and eosinophil activation (IL-5). Th17 cells recruit neutrophils to mucosal infections. Follicular helper T cells (Tfh) in germinal centers express CXCR5 and provide B cell help via IL-21 and CD40L. HIV targets CD4+ cells, leading to AIDS.',
  },
  keyFacts: [
    'Express CD4, recognize MHC class II',
    'Th1: cell-mediated immunity (intracellular pathogens)',
    'Th2: humoral immunity (parasites, allergies)',
    'Th17: mucosal immunity (fungi, extracellular bacteria)',
    'HIV target - CD4 count defines AIDS',
  ],
  pathologies: [
    {
      name: 'HIV/AIDS',
      description: 'Destruction of CD4+ T cells by HIV',
      symptoms: ['Opportunistic infections', 'Kaposi sarcoma', 'Wasting'],
      causes: ['HIV infection'],
      labFindings: ['Low CD4 count (<200 = AIDS)', 'HIV viral load'],
    },
  ],
});

immuneCells.set('t-cytotoxic', {
  id: 't-cytotoxic',
  name: 'Cytotoxic T Cell (CD8+)',
  alternateNames: ['CD8+ T cell', 'CTL', 'Killer T cell'],
  type: 'lymphocyte',
  origin: 'Bone marrow',
  maturationSite: 'Thymus',
  lifespan: 'Weeks to months (memory: years)',
  surfaceMarkers: ['CD3', 'CD8', 'TCR'],
  functions: [
    'Kill virus-infected cells',
    'Kill tumor cells',
    'Kill intracellular bacteria-infected cells',
  ],
  cytokinesProduced: ['IFN-γ', 'TNF-α'],
  explanations: {
    level1: 'Cytotoxic T cells are like assassins that kill cells infected with viruses.',
    level2: 'CD8+ T cells recognize infected or abnormal cells and kill them directly using toxic granules or death receptors.',
    level3: 'CD8+ T cells recognize peptide-MHC class I on target cells. Killing mechanisms: perforin/granzyme (pore formation, apoptosis induction) and FasL-Fas (death receptor pathway).',
    level4: 'Upon TCR engagement with peptide-MHC I, CTLs form immunological synapse and release cytotoxic granules directionally. Perforin creates pores; granzymes enter and activate caspase cascade. FasL engagement of Fas triggers DISC formation and apoptosis. CTLs can kill multiple targets sequentially.',
    level5: 'CTL activation requires: TCR signal (peptide-MHC I), co-stimulation, and IL-2 (often from CD4+ cells). Effector CTLs re-express lymph node homing receptors for trafficking to infected tissues. Memory CTLs are critical for rapid secondary responses to viruses. Tumor immunotherapy (checkpoint inhibitors, CAR-T) enhances CTL function.',
  },
  keyFacts: [
    'Express CD8, recognize MHC class I',
    'Kill via perforin/granzyme pathway',
    'Kill via Fas-FasL pathway',
    'Critical for viral clearance and tumor immunity',
    'Checkpoint inhibitors enhance CTL anti-tumor activity',
  ],
});

immuneCells.set('b-cell', {
  id: 'b-cell',
  name: 'B Lymphocyte',
  alternateNames: ['B cell'],
  type: 'lymphocyte',
  origin: 'Bone marrow',
  maturationSite: 'Bone marrow',
  lifespan: 'Weeks (plasma cells: days to months; memory B cells: years)',
  surfaceMarkers: ['CD19', 'CD20', 'CD21', 'surface Ig (BCR)', 'MHC II'],
  functions: [
    'Produce antibodies',
    'Present antigen to T cells',
    'Form memory cells for recall responses',
  ],
  cytokinesProduced: ['IL-10', 'IL-6'],
  explanations: {
    level1: 'B cells make antibodies - proteins that stick to germs and help destroy them.',
    level2: 'B cells recognize specific antigens with their B cell receptor (BCR). When activated, they become plasma cells that secrete antibodies, or memory cells for future protection.',
    level3: 'B cell activation can be T-dependent (protein antigens, requires T cell help, leads to germinal center, affinity maturation, isotype switching) or T-independent (polysaccharides, rapid IgM response).',
    level4: 'T-dependent response: B cell presents antigen on MHC II to Tfh cell. Tfh provides help via CD40L and IL-21. B cells enter germinal center: dark zone (somatic hypermutation), light zone (selection on FDC). High-affinity clones differentiate into plasma cells or memory B cells.',
    level5: 'Somatic hypermutation introduces point mutations in Ig variable regions via AID (activation-induced cytidine deaminase). Selection on follicular dendritic cells favors high-affinity clones. Isotype switching (IgM → IgG, IgA, IgE) requires AID and specific cytokines (IL-4 → IgE; TGF-β → IgA). Plasma cells migrate to bone marrow for long-term antibody production. Memory B cells persist and can rapidly differentiate upon re-exposure.',
  },
  keyFacts: [
    'Mature in bone marrow (mammals)',
    'BCR: membrane-bound antibody',
    'Plasma cells: antibody factories (CD138+, no surface Ig)',
    'T-dependent response: germinal center, affinity maturation',
    'Memory B cells provide rapid recall response',
  ],
  pathologies: [
    {
      name: 'X-linked agammaglobulinemia (Bruton)',
      description: 'B cell development arrest due to BTK mutation',
      symptoms: ['Recurrent bacterial infections after ~6 months'],
      causes: ['BTK gene mutation'],
      labFindings: ['No B cells', 'Very low Ig all classes'],
    },
  ],
});

immuneCells.set('macrophage', {
  id: 'macrophage',
  name: 'Macrophage',
  alternateNames: ['Mononuclear phagocyte'],
  type: 'myeloid',
  origin: 'Bone marrow (monocyte)',
  maturationSite: 'Tissues (from blood monocytes)',
  lifespan: 'Months to years',
  surfaceMarkers: ['CD14', 'CD68', 'CD163', 'MHC II', 'various receptors (TLRs, complement, Fc)'],
  functions: [
    'Phagocytosis of pathogens and debris',
    'Antigen presentation',
    'Cytokine production',
    'Tissue remodeling and repair',
  ],
  cytokinesProduced: ['TNF-α', 'IL-1', 'IL-6', 'IL-12', 'IL-10'],
  explanations: {
    level1: 'Macrophages are like garbage trucks that eat germs and dead cells.',
    level2: 'Macrophages are large cells that engulf and digest pathogens (phagocytosis). They also present antigens to T cells and produce cytokines that coordinate inflammation.',
    level3: 'Tissue-resident macrophages have specific names: Kupffer cells (liver), microglia (CNS), alveolar macrophages (lung), osteoclasts (bone). They can be M1 (pro-inflammatory) or M2 (anti-inflammatory, tissue repair) polarized.',
    level4: 'Recognition via pattern recognition receptors (TLRs, mannose receptor, scavenger receptors) and opsonin receptors (FcγR, complement receptors). M1 polarization (IFN-γ, LPS): microbicidal, pro-inflammatory. M2 polarization (IL-4, IL-13): tissue repair, anti-inflammatory.',
    level5: 'Macrophage activation by IFN-γ increases MHC II, ROS/RNS production (respiratory burst), and pro-inflammatory cytokines. Phagocytosis triggers: FcγR ligation (opsonized targets), complement receptor (C3b-coated), PRR (PAMPs). Phagolysosome fusion delivers hydrolases and antimicrobial peptides. Chronic infection can lead to granuloma formation (epithelioid macrophages, giant cells). Tissue-resident macrophages can self-renew independent of monocyte input.',
  },
  keyFacts: [
    'Derived from monocytes in tissues',
    'Key phagocytic cell (innate immunity)',
    'Antigen-presenting cell (adaptive immunity)',
    'M1 (classical) vs M2 (alternative) activation',
    'Tissue-specific names (Kupffer, microglia, alveolar)',
  ],
});

immuneCells.set('neutrophil', {
  id: 'neutrophil',
  name: 'Neutrophil',
  alternateNames: ['PMN', 'Polymorphonuclear leukocyte'],
  type: 'myeloid',
  origin: 'Bone marrow',
  maturationSite: 'Bone marrow',
  lifespan: '6-8 hours in circulation (days in tissues)',
  surfaceMarkers: ['CD66b', 'CD15', 'CD16', 'FcγRIII'],
  functions: [
    'First responder to infection',
    'Phagocytosis of bacteria',
    'Degranulation (antimicrobial enzymes)',
    'NET formation',
  ],
  cytokinesProduced: ['IL-8', 'TNF-α'],
  explanations: {
    level1: 'Neutrophils are first responders that rush to fight bacteria.',
    level2: 'Neutrophils are the most common white blood cell and first to arrive at infection sites. They engulf and kill bacteria using toxic chemicals and enzymes.',
    level3: 'Neutrophils contain granules: primary (azurophilic: myeloperoxidase, defensins), secondary (specific: lactoferrin, collagenase), tertiary (gelatinase). They kill via respiratory burst (ROS) and release of antimicrobial proteins.',
    level4: 'Recruitment: rolling (selectins) → activation (chemokines) → firm adhesion (integrins) → transmigration. Killing mechanisms: phagocytosis with oxidative burst (NADPH oxidase), degranulation, NETs (neutrophil extracellular traps: extruded chromatin with antimicrobials).',
    level5: 'Respiratory burst: NADPH oxidase generates superoxide; MPO converts to HOCl (bleach). Chronic granulomatous disease (CGD): NADPH oxidase deficiency → susceptibility to catalase-positive organisms. NETs trap bacteria but can contribute to tissue damage and autoimmunity. Left shift: immature neutrophils (bands) in circulation during severe infection.',
  },
  keyFacts: [
    'Most abundant WBC (50-70%)',
    'First cells at infection site (within hours)',
    'Multilobed nucleus (3-5 lobes)',
    'Respiratory burst: NADPH oxidase → ROS',
    'Short-lived: 6-8 hours in circulation',
  ],
  pathologies: [
    {
      name: 'Chronic granulomatous disease (CGD)',
      description: 'NADPH oxidase deficiency',
      symptoms: ['Recurrent bacterial and fungal infections', 'Granulomas'],
      causes: ['X-linked or autosomal recessive NADPH oxidase mutations'],
      labFindings: ['Absent respiratory burst (DHR or NBT test negative)'],
    },
  ],
});

immuneCells.set('dendritic-cell', {
  id: 'dendritic-cell',
  name: 'Dendritic Cell',
  alternateNames: ['DC'],
  type: 'antigen-presenting',
  origin: 'Bone marrow',
  maturationSite: 'Tissues (Langerhans cells in skin)',
  lifespan: 'Days to weeks',
  surfaceMarkers: ['CD11c', 'MHC II', 'CD80', 'CD86', 'CD40'],
  functions: [
    'Professional antigen-presenting cell',
    'Link innate and adaptive immunity',
    'Migrate to lymph nodes to activate T cells',
  ],
  cytokinesProduced: ['IL-12', 'Type I interferons', 'IL-6'],
  explanations: {
    level1: 'Dendritic cells are messengers that show T cells what germs look like.',
    level2: 'Dendritic cells capture antigens in tissues, then travel to lymph nodes where they present these antigens to T cells, initiating the adaptive immune response.',
    level3: 'Immature DCs in tissues capture antigens via phagocytosis, macropinocytosis, and receptor-mediated endocytosis. They mature and migrate to lymph nodes, upregulating MHC II and co-stimulatory molecules to activate naive T cells.',
    level4: 'DC subsets: conventional DCs (cDC1: cross-present to CD8; cDC2: activate CD4), plasmacytoid DCs (pDCs: produce type I IFN in viral infections), Langerhans cells (skin). Maturation signals: TLR ligands, inflammatory cytokines, CD40L.',
    level5: 'DCs are the only cells that efficiently activate naive T cells. Cross-presentation: exogenous antigens presented on MHC I (via TAP-dependent or vacuolar pathway). Critical for CTL responses to tumors and viruses. pDCs sense viral nucleic acids via TLR7/9, producing massive type I IFN. DC-based vaccines being developed for cancer immunotherapy.',
  },
  keyFacts: [
    'Most potent antigen-presenting cell',
    'Captures antigen in periphery → migrates to lymph node',
    'Activates naive T cells',
    'Langerhans cells: skin-resident DCs',
    'Cross-presentation: present exogenous Ag on MHC I',
  ],
});

immuneCells.set('nk-cell', {
  id: 'nk-cell',
  name: 'Natural Killer Cell',
  alternateNames: ['NK cell'],
  type: 'innate-lymphoid',
  origin: 'Bone marrow',
  maturationSite: 'Bone marrow, lymph nodes',
  lifespan: 'Weeks',
  surfaceMarkers: ['CD56', 'CD16 (FcγRIII)', 'KIRs', 'NKG2D'],
  functions: [
    'Kill virus-infected cells',
    'Kill tumor cells',
    'ADCC (antibody-dependent cellular cytotoxicity)',
  ],
  cytokinesProduced: ['IFN-γ', 'TNF-α'],
  explanations: {
    level1: 'NK cells are natural killers that destroy infected or cancer cells without needing prior exposure.',
    level2: 'NK cells are part of innate immunity. They recognize and kill cells that are missing normal markers (MHC I) or expressing stress signals, including virus-infected and tumor cells.',
    level3: 'NK cell activity determined by balance of activating (NKG2D, natural cytotoxicity receptors) and inhibitory (KIRs binding MHC I) signals. "Missing self" hypothesis: cells lacking MHC I are killed.',
    level4: 'NK cells kill via perforin/granzyme (like CTLs) and death receptors (TRAIL, FasL). CD16 (FcγRIIIA) enables ADCC: NK cells kill antibody-coated targets. IL-2 and IL-15 activate NK cells.',
    level5: 'KIRs (killer immunoglobulin-like receptors) recognize specific HLA alleles; polymorphism affects disease susceptibility. NKG2D recognizes stress ligands (MICA, MICB) upregulated on infected/transformed cells. NK cells don\'t require prior sensitization - immediate response. Memory-like NK cells described in CMV infection. CAR-NK therapy being developed for cancer.',
  },
  keyFacts: [
    'Innate lymphoid cell (no antigen-specific receptor)',
    'Kill via perforin/granzyme (like CTL)',
    'ADCC via CD16 (FcγRIII)',
    '"Missing self": kill cells lacking MHC I',
    'Important for viral and tumor immunity',
  ],
});

// ============================================================================
// IMMUNOGLOBULINS
// ============================================================================

export const IMMUNOGLOBULIN_CLASSES: ImmunoglobulinClass[] = [
  {
    name: 'Immunoglobulin G',
    abbreviation: 'IgG',
    structure: 'Monomer, 4 subclasses (IgG1-4)',
    location: 'Blood, tissues (crosses placenta)',
    functions: ['Opsonization', 'Complement activation (classical)', 'ADCC', 'Neutralization', 'Neonatal immunity'],
    percentageOfTotal: '75-80%',
    halfLife: '23 days',
    clinicalNote: 'Main antibody of secondary response; only Ig to cross placenta',
  },
  {
    name: 'Immunoglobulin A',
    abbreviation: 'IgA',
    structure: 'Monomer (serum), Dimer with J chain and secretory component (mucosal)',
    location: 'Mucosal surfaces (GI, respiratory, genitourinary), breast milk, saliva, tears',
    functions: ['Mucosal immunity', 'Neutralization at mucosal surfaces', 'Prevents pathogen attachment'],
    percentageOfTotal: '10-15%',
    halfLife: '5-6 days',
    clinicalNote: 'Most produced Ig overall; secretory IgA protects mucosal surfaces',
  },
  {
    name: 'Immunoglobulin M',
    abbreviation: 'IgM',
    structure: 'Pentamer with J chain (secreted), Monomer (membrane BCR)',
    location: 'Blood (does not enter tissues well due to size)',
    functions: ['Primary response', 'Complement activation (most efficient)', 'Agglutination'],
    percentageOfTotal: '5-10%',
    halfLife: '5 days',
    clinicalNote: 'First antibody produced; indicates acute infection',
  },
  {
    name: 'Immunoglobulin E',
    abbreviation: 'IgE',
    structure: 'Monomer',
    location: 'Bound to mast cells and basophils (very low in serum)',
    functions: ['Type I hypersensitivity (allergy)', 'Parasite defense', 'Mast cell degranulation'],
    percentageOfTotal: '<0.01%',
    halfLife: '2 days (free); weeks when bound to mast cells',
    clinicalNote: 'Mediates allergic reactions; elevated in parasitic infections and atopy',
  },
  {
    name: 'Immunoglobulin D',
    abbreviation: 'IgD',
    structure: 'Monomer',
    location: 'B cell surface (co-expressed with IgM on naive B cells)',
    functions: ['B cell receptor function', 'B cell activation'],
    percentageOfTotal: '<1%',
    halfLife: '3 days',
    clinicalNote: 'Function not fully understood; may signal B cell activation',
  },
];

// ============================================================================
// CYTOKINES
// ============================================================================

export const KEY_CYTOKINES: Cytokine[] = [
  {
    id: 'il-1',
    name: 'Interleukin-1',
    abbreviation: 'IL-1',
    source: ['Macrophages', 'Monocytes', 'Dendritic cells', 'Epithelial cells'],
    targets: ['Hypothalamus', 'Liver', 'T cells', 'B cells'],
    functions: ['Fever (endogenous pyrogen)', 'Acute phase response', 'T cell activation'],
    clinicalNote: 'IL-1 inhibitors (anakinra) used in autoinflammatory diseases',
  },
  {
    id: 'il-2',
    name: 'Interleukin-2',
    abbreviation: 'IL-2',
    source: ['Activated T cells (mainly CD4+)'],
    targets: ['T cells', 'NK cells', 'B cells'],
    functions: ['T cell proliferation', 'NK cell activation', 'Treg maintenance'],
    clinicalNote: 'High-dose IL-2 for melanoma; anti-CD25 blocks IL-2R on Tregs',
  },
  {
    id: 'il-6',
    name: 'Interleukin-6',
    abbreviation: 'IL-6',
    source: ['Macrophages', 'T cells', 'Endothelium'],
    targets: ['Liver', 'B cells', 'T cells'],
    functions: ['Acute phase proteins (CRP)', 'B cell differentiation', 'Th17 differentiation'],
    clinicalNote: 'IL-6 inhibitors (tocilizumab) for RA, cytokine storm',
  },
  {
    id: 'il-10',
    name: 'Interleukin-10',
    abbreviation: 'IL-10',
    source: ['Tregs', 'Th2 cells', 'Macrophages', 'B cells'],
    targets: ['Macrophages', 'Dendritic cells', 'T cells'],
    functions: ['Anti-inflammatory', 'Suppress macrophage/DC function', 'Inhibit Th1 responses'],
    clinicalNote: 'Key regulatory cytokine; deficiency leads to colitis',
  },
  {
    id: 'il-12',
    name: 'Interleukin-12',
    abbreviation: 'IL-12',
    source: ['Dendritic cells', 'Macrophages'],
    targets: ['T cells', 'NK cells'],
    functions: ['Th1 differentiation', 'IFN-γ production', 'NK activation'],
    clinicalNote: 'Important for cell-mediated immunity; deficiency increases mycobacterial infection risk',
  },
  {
    id: 'ifn-gamma',
    name: 'Interferon-gamma',
    abbreviation: 'IFN-γ',
    source: ['Th1 cells', 'CD8+ T cells', 'NK cells'],
    targets: ['Macrophages', 'All nucleated cells'],
    functions: ['Macrophage activation', 'MHC upregulation', 'Th1 response', 'Antiviral state'],
    clinicalNote: 'Key cytokine for intracellular pathogen defense; deficiency predisposes to mycobacterial infections',
  },
  {
    id: 'tnf-alpha',
    name: 'Tumor Necrosis Factor-alpha',
    abbreviation: 'TNF-α',
    source: ['Macrophages', 'T cells', 'NK cells'],
    targets: ['Endothelium', 'Neutrophils', 'Hypothalamus', 'Liver'],
    functions: ['Inflammation', 'Endothelial activation', 'Fever', 'Cachexia'],
    clinicalNote: 'TNF inhibitors (infliximab, adalimumab) for RA, IBD, psoriasis',
  },
];

// ============================================================================
// IMMUNE RESPONSE PHASES
// ============================================================================

export const INNATE_IMMUNE_RESPONSE: ImmuneResponsePhase[] = [
  {
    phase: 'Barrier Defense',
    timeframe: 'Constant',
    description: 'Physical, chemical, and microbial barriers prevent pathogen entry',
    keyEvents: ['Epithelial barrier', 'Mucus trapping', 'Antimicrobial peptides (defensins)', 'Commensal flora competition'],
    cells: ['Epithelial cells'],
  },
  {
    phase: 'Recognition',
    timeframe: '0-4 hours',
    description: 'Pattern recognition receptors detect pathogen-associated molecular patterns',
    keyEvents: ['TLR recognition of PAMPs', 'Complement activation', 'Macrophage/DC activation'],
    cells: ['Macrophages', 'Dendritic cells', 'Mast cells'],
  },
  {
    phase: 'Inflammation',
    timeframe: '0-96 hours',
    description: 'Inflammatory mediators recruit immune cells to infection site',
    keyEvents: ['Vasodilation', 'Increased permeability', 'Neutrophil recruitment', 'Phagocytosis'],
    cells: ['Neutrophils', 'Macrophages', 'Mast cells'],
  },
];

export const ADAPTIVE_IMMUNE_RESPONSE: ImmuneResponsePhase[] = [
  {
    phase: 'Antigen Recognition',
    timeframe: 'Days 0-4',
    description: 'Dendritic cells present antigen to naive T cells in lymph nodes',
    keyEvents: ['DC migration to lymph node', 'Antigen presentation on MHC', 'T cell activation'],
    cells: ['Dendritic cells', 'Naive T cells'],
  },
  {
    phase: 'Clonal Expansion',
    timeframe: 'Days 4-7',
    description: 'Activated lymphocytes proliferate',
    keyEvents: ['T cell proliferation', 'B cell activation', 'Differentiation into effector cells'],
    cells: ['Effector T cells', 'Plasma cells'],
  },
  {
    phase: 'Effector Phase',
    timeframe: 'Days 7-14',
    description: 'Effector cells eliminate pathogen',
    keyEvents: ['CTL killing', 'Antibody production', 'Macrophage activation by Th1'],
    cells: ['Effector T cells', 'Plasma cells', 'Activated macrophages'],
  },
  {
    phase: 'Contraction & Memory',
    timeframe: 'Days 14+',
    description: 'Most effector cells die; memory cells persist',
    keyEvents: ['Apoptosis of effector cells', 'Memory cell survival', 'Long-lived plasma cells'],
    cells: ['Memory T cells', 'Memory B cells', 'Long-lived plasma cells'],
  },
];

// ============================================================================
// INDEXES
// ============================================================================

const structuresByType: Map<string, LymphaticStructure[]> = new Map();

for (const structure of lymphaticStructures.values()) {
  const existing = structuresByType.get(structure.organType) || [];
  existing.push(structure);
  structuresByType.set(structure.organType, existing);
}

// ============================================================================
// API FUNCTIONS
// ============================================================================

/**
 * Get a lymphatic structure by ID
 */
export function getLymphaticStructure(id: string): LymphaticStructure | undefined {
  return lymphaticStructures.get(id);
}

/**
 * Get all lymphatic structures
 */
export function getAllLymphaticStructures(): LymphaticStructure[] {
  return Array.from(lymphaticStructures.values());
}

/**
 * Get lymphatic structures by organ type
 */
export function getLymphaticStructuresByType(type: LymphaticOrganType): LymphaticStructure[] {
  return structuresByType.get(type) || [];
}

/**
 * Get an immune cell by ID
 */
export function getImmuneCell(id: string): ImmuneCell | undefined {
  return immuneCells.get(id);
}

/**
 * Get all immune cells
 */
export function getAllImmuneCells(): ImmuneCell[] {
  return Array.from(immuneCells.values());
}

/**
 * Search lymphatic/immune structures
 */
export function searchLymphatic(query: string): (LymphaticStructure | ImmuneCell)[] {
  const lowerQuery = query.toLowerCase();
  const results: (LymphaticStructure | ImmuneCell)[] = [];

  for (const structure of lymphaticStructures.values()) {
    if (
      structure.name.toLowerCase().includes(lowerQuery) ||
      structure.function.toLowerCase().includes(lowerQuery)
    ) {
      results.push(structure);
    }
  }

  for (const cell of immuneCells.values()) {
    if (
      cell.name.toLowerCase().includes(lowerQuery) ||
      cell.functions.some((f) => f.toLowerCase().includes(lowerQuery))
    ) {
      results.push(cell);
    }
  }

  return results;
}

/**
 * Get explanation at a specific level
 */
export function getLymphaticExplanation(
  id: string,
  level: 1 | 2 | 3 | 4 | 5
): string | undefined {
  const structure = lymphaticStructures.get(id);
  if (structure) return structure.explanations[`level${level}`];

  const cell = immuneCells.get(id);
  if (cell) return cell.explanations[`level${level}`];

  return undefined;
}

/**
 * Get lymphatic system statistics
 */
export function getLymphaticStatistics(): LymphaticStatistics {
  return {
    totalStructures: lymphaticStructures.size,
    lymphNodes: '~600 nodes',
    immuneCellTypes: immuneCells.size,
    dailyLymphProduction: '~3 liters',
  };
}
