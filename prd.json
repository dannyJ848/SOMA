{
  "project": "Biological Self",
  "branchName": "ralph/phase-2-ai-layer",
  "description": "Phase 2: AI Layer - Local LLM integration for health insights, natural language input, and intelligent analysis",
  "userStories": [
    {
      "id": "US-009",
      "title": "Tauri desktop app shell",
      "description": "Create Tauri application wrapper with React frontend. Configure build for macOS initially. Set up IPC bridge between Rust backend and React frontend for database operations.",
      "acceptanceCriteria": [
        "Tauri app launches on macOS",
        "React frontend renders inside Tauri window",
        "IPC calls successfully reach TypeScript database layer",
        "App icon and basic window chrome configured",
        "npm run tauri dev starts the application",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": "Use @tauri-apps/api for IPC. Keep existing TypeScript/SQLite code, invoke via Tauri commands. Existing database is at data/biological-self.db"
    },
    {
      "id": "US-010",
      "title": "Authentication and encryption setup flow",
      "description": "First-run experience: create passphrase, explain local encryption, initialize database. Subsequent runs: passphrase entry to unlock.",
      "acceptanceCriteria": [
        "First-run detects no existing database",
        "User creates and confirms passphrase",
        "Clear explanation that data never leaves device",
        "Passphrase unlocks existing database on subsequent launches",
        "Failed passphrase shows error, allows retry",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": "Use existing BiologicalSelfStore from core/biological-self/store.ts. Passphrase derives AES-256-GCM key."
    },
    {
      "id": "US-011",
      "title": "Dashboard home screen",
      "description": "Main dashboard showing health snapshot: recent vitals, active conditions, current medications, latest labs with trends, recent symptoms.",
      "acceptanceCriteria": [
        "Dashboard loads existing data from encrypted store",
        "Shows cards for: vitals summary, active conditions, current meds, recent labs",
        "Labs show trend indicators (up/down arrows)",
        "Click any card to navigate to detail view",
        "Empty states for sections with no data",
        "Typecheck passes"
      ],
      "priority": 3,
      "passes": true,
      "notes": "Database already has: 75 labs, 255 Whoop cycles, 891 Apple Health summaries. Use store.get() to load data."
    },
    {
      "id": "US-012",
      "title": "Health timeline view",
      "description": "Chronological timeline of all health events: symptoms, labs, imaging, medication changes, conditions diagnosed. Filterable by category.",
      "acceptanceCriteria": [
        "Vertical timeline with events plotted by date",
        "Color-coded by event type (lab=blue, imaging=purple, symptom=orange)",
        "Filter toggles for each event type",
        "Click event to see detail modal",
        "Date range selector",
        "Typecheck passes"
      ],
      "priority": 4,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-013",
      "title": "Symptom data model",
      "description": "Add Symptom type to data model: description, severity (1-10), body location (anatomical code), onset date, duration, associated factors, resolution.",
      "acceptanceCriteria": [
        "Symptom interface added to core/biological-self/types.ts",
        "symptoms[] array added to BiologicalSelf interface",
        "Store methods: addSymptom, updateSymptom, getSymptomsByLocation, getSymptomsByDateRange",
        "Deserialize handles symptom dates correctly",
        "Typecheck passes"
      ],
      "priority": 5,
      "passes": true,
      "notes": "Body location should use hierarchical codes: body.torso.abdomen.right-lower-quadrant"
    },
    {
      "id": "US-014",
      "title": "2D anatomical body diagram",
      "description": "SVG-based 2D human body outline (anterior/posterior views) with clickable regions. Clicking a region selects it for symptom entry.",
      "acceptanceCriteria": [
        "SVG body diagram renders (front and back views)",
        "Toggle between anterior/posterior",
        "Hover highlights body region with name tooltip",
        "Click selects region, shows selection state",
        "Selected region ID passed to symptom entry form",
        "Existing symptoms shown as markers on diagram",
        "Typecheck passes"
      ],
      "priority": 6,
      "passes": true,
      "notes": "Use hierarchical SVG groups: body > torso > abdomen > quadrants. Each clickable region has data-location attribute."
    },
    {
      "id": "US-015",
      "title": "Manual symptom entry form",
      "description": "Form to record a symptom: select body location (from diagram or dropdown), describe symptom, rate severity, set onset, add notes.",
      "acceptanceCriteria": [
        "Form opens with body location pre-selected if clicked from diagram",
        "Text field for symptom description",
        "Severity slider 1-10 with descriptive labels",
        "Date/time picker for onset",
        "Duration field (ongoing or specify)",
        "Associated factors checkboxes (after eating, with exertion, at rest, etc.)",
        "Save adds to database, shows on timeline and body diagram",
        "Typecheck passes"
      ],
      "priority": 7,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-016",
      "title": "Local LLM integration with Ollama",
      "description": "Set up Ollama integration for local AI inference. Create a TypeScript service layer that communicates with Ollama API. All AI processing stays on device.",
      "acceptanceCriteria": [
        "Ollama service module created in core/ai/ollama.ts",
        "Function to check if Ollama is running locally",
        "Function to list available models",
        "Function to send chat completion requests",
        "Function to stream responses",
        "Graceful error handling when Ollama not available",
        "Tauri command to proxy AI requests",
        "Typecheck passes"
      ],
      "priority": 8,
      "passes": true,
      "notes": "Use Ollama REST API at http://localhost:11434. User has deepseek-r1:14b pulled. Keep all inference local - this is core to privacy promise."
    },
    {
      "id": "US-017",
      "title": "AI chat interface",
      "description": "Chat UI for asking questions about your health data. AI has context of your conditions, medications, symptoms, and labs to provide personalized (educational) responses.",
      "acceptanceCriteria": [
        "Chat view accessible from main navigation",
        "Message input with send button",
        "Chat history displayed in scrollable container",
        "AI responses stream in real-time",
        "System prompt includes relevant health context",
        "Clear disclaimer that this is educational, not medical advice",
        "Typecheck passes"
      ],
      "priority": 9,
      "passes": true,
      "notes": "Build health context from store.get() - include active conditions, current meds, recent symptoms, abnormal labs. Keep context focused to fit in model's window."
    },
    {
      "id": "US-018",
      "title": "Natural language symptom entry",
      "description": "Allow users to describe symptoms in natural language. AI extracts structured data (body location, severity, duration, factors) and pre-fills the symptom form.",
      "acceptanceCriteria": [
        "Text input for natural language symptom description",
        "AI parses description and extracts structured fields",
        "Pre-fills symptom form with extracted data",
        "User can review and edit before saving",
        "Handles ambiguous input gracefully",
        "Works offline if Ollama is running",
        "Typecheck passes"
      ],
      "priority": 10,
      "passes": true,
      "notes": "Use structured output / JSON mode if available. Example: 'sharp pain in my lower right stomach after eating for 2 hours' -> {bodyLocation: 'body.torso.abdomen.right-lower-quadrant', severity: 6, associatedFactors: ['after-eating'], duration: {value: 2, unit: 'hours'}}"
    },
    {
      "id": "US-019",
      "title": "Health insights panel",
      "description": "AI-generated insights panel on dashboard showing patterns, correlations, and observations from health data. Educational summaries of trends.",
      "acceptanceCriteria": [
        "Insights section on dashboard",
        "AI analyzes symptoms, labs, vitals for patterns",
        "Shows correlations (e.g., symptoms after certain foods)",
        "Highlights abnormal lab trends",
        "Insights refresh on data changes",
        "Loading state while generating",
        "Typecheck passes"
      ],
      "priority": 11,
      "passes": false,
      "notes": "Generate insights asynchronously. Cache results until data changes. Focus on objective observations, not diagnoses. Example: 'Your headache symptoms appear more frequently on days with less than 6 hours of sleep.'"
    }
  ]
}
